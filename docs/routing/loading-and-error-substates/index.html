<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#e46652">

    <title>Ember.js - ルーティング: ロード中とエラーの表示</title>
    <meta property="st:title" content="ルーティング: ロード中とエラーの表示" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../../images/favicon.png" rel="icon" type="image/png" />
    <!--[if lte IE 7 ]><link href="../../stylesheets/fonts/fontello-ie7.css" rel="stylesheet" /><![endif]-->
    <link href="../../stylesheets/application.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600" rel="stylesheet">
    <!-- This TypeKit account is managed by @wifelette. Contact her with any issues. -->
    <script src="https://use.typekit.net/stz3kpn.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>

    <link href="/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js - ブログ" />
    
  </head>

  <body class="guides routing routing_loading-and-error-substates routing_loading-and-error-substates_index">

    <!--[if lt IE 9]>
      <script src="../../javascripts/common-old-ie.js"></script>
    <![endif]-->
    <!--[if gte IE 9]><!-->
      <script src="../../javascripts/common-modern.js"></script>
    <!--<![endif]-->

    <header class="header">
  <nav role="navigation" aria-label="main">
    <ul class="header-nav container">
      <li class="header-logo">
        <a href="http://emberjs.com/"><span class="visually-hidden">Emberホームページ</span></a>
      </li>
      <li>
        <a href="http://emberjs.com/learn">参考</a>
      </li>
      <li class="active" aria-label="You are here">
        <a href="/">ガイド</a>
      </li>
      <li>
        <a href="http://emberjs.com/api">API</a>
      </li>
      <li>
        <a href="http://emberjs.com/community">コミュニティ</a>
      </li>
      <li>
        <a href="http://emberjs.com/blog">ブログ</a>
      </li>
      <li>
        <a href="http://emberjs.com/builds">リリース</a>
      </li>

      <li class="header-search">
        <form>
          <input type="text" id="search-input" class="search-input" placeholder="ガイド内検索"/>
        </form>
      </li>
    </ul>
  </nav>
</header>


    

    <main class="container">

      <aside class="sidebar">
  <input id="toc-toggle" class="toc-toggle visually-hidden" type="checkbox" />
  <label for="toc-toggle">目次 <span class="visually-hidden">切替</span></label>

  <nav class='toc-container' aria-label='table of contents'><ol class='toc-level-0 selected'><li class='toc-level-0 '><a href="#">はじめに</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../getting-started/quick-start/">クイックスタート</a></li><li class='toc-level-1 '><a href="../../getting-started/">Emberのインストール</a></li><li class='toc-level-1 '><a href="../../getting-started/core-concepts/">Emberのコアコンセプト</a></li><li class='toc-level-1 '><a href="../../getting-started/js-primer/">JavaScript手引き</a></li></ol></li><li class='toc-level-0 '><a href="#">チュートリアル</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../tutorial/ember-cli/">アプリの作成</a></li><li class='toc-level-1 '><a href="../../tutorial/acceptance-test/">プランニング</a></li><li class='toc-level-1 '><a href="../../tutorial/routes-and-templates/">ルートとテンプレート</a></li><li class='toc-level-1 '><a href="../../tutorial/model-hook/">モデルフック</a></li><li class='toc-level-1 '><a href="../../tutorial/installing-addons/">アドオンのインストール</a></li><li class='toc-level-1 '><a href="../../tutorial/simple-component/">コンポーネントの作成</a></li><li class='toc-level-1 '><a href="../../tutorial/hbs-helper/">ヘルパーの作成</a></li><li class='toc-level-1 '><a href="../../tutorial/ember-data/">Ember Dataを使う</a></li><li class='toc-level-1 '><a href="../../tutorial/autocomplete-component/">複雑なコンポーネントの作成</a></li><li class='toc-level-1 '><a href="../../tutorial/service/">サービスとユーティリティ</a></li><li class='toc-level-1 '><a href="../../tutorial/subroutes/">ネストしたルートの作成</a></li><li class='toc-level-1 '><a href="../../tutorial/deploying/">デプロイ</a></li></ol></li><li class='toc-level-0 '><a href="#">オブジェクトモデル</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../object-model/">Emberのオブジェクト</a></li><li class='toc-level-1 '><a href="../../object-model/classes-and-instances/">クラスとインスタンス</a></li><li class='toc-level-1 '><a href="../../object-model/reopening-classes-and-instances/">クラスとインスタンスの再オープン</a></li><li class='toc-level-1 '><a href="../../object-model/computed-properties/">算出プロパティ</a></li><li class='toc-level-1 '><a href="../../object-model/computed-properties-and-aggregate-data/">算出プロパティとデータ集計</a></li><li class='toc-level-1 '><a href="../../object-model/observers/">オブザーバー</a></li><li class='toc-level-1 '><a href="../../object-model/bindings/">バインディング</a></li><li class='toc-level-1 '><a href="../../object-model/enumerables/">列挙型</a></li></ol></li><li class='toc-level-0 selected'><a href="#">ルーティング</a><ol class='toc-level-1 selected'><li class='toc-level-1 '><a href="../">はじめに</a></li><li class='toc-level-1 '><a href="../defining-your-routes/">ルートの定義</a></li><li class='toc-level-1 '><a href="../specifying-a-routes-model/">ルートのモデルを指定する</a></li><li class='toc-level-1 '><a href="../rendering-a-template/">テンプレートの描画</a></li><li class='toc-level-1 '><a href="../redirection/">リダイレクション</a></li><li class='toc-level-1 '><a href="../preventing-and-retrying-transitions/">トランジションの中止と再開</a></li><li class='toc-level-1 selected'><a href="./">ロード中とエラーの表示</a></li><li class='toc-level-1 '><a href="../query-params/">クエリーパラメーター</a></li><li class='toc-level-1 '><a href="../asynchronous-routing/">非同期ルーティング</a></li></ol></li><li class='toc-level-0 '><a href="#">テンプレート</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../templates/handlebars-basics/">Handlebarsの基礎</a></li><li class='toc-level-1 '><a href="../../templates/built-in-helpers/">ビルトインヘルパー</a></li><li class='toc-level-1 '><a href="../../templates/conditionals/">条件分岐</a></li><li class='toc-level-1 '><a href="../../templates/displaying-a-list-of-items/">リストの表示</a></li><li class='toc-level-1 '><a href="../../templates/displaying-the-keys-in-an-object/">オブジェクトのキーの表示</a></li><li class='toc-level-1 '><a href="../../templates/binding-element-attributes/">要素の属性のバインディング</a></li><li class='toc-level-1 '><a href="../../templates/links/">リンク</a></li><li class='toc-level-1 '><a href="../../templates/actions/">アクション</a></li><li class='toc-level-1 '><a href="../../templates/input-helpers/">inputヘルパー</a></li><li class='toc-level-1 '><a href="../../templates/development-helpers/">開発用ヘルパー</a></li><li class='toc-level-1 '><a href="../../templates/writing-helpers/">ヘルパーの作成</a></li></ol></li><li class='toc-level-0 '><a href="#">コンポーネント</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../components/defining-a-component/">コンポーネントの定義</a></li><li class='toc-level-1 '><a href="../../components/the-component-lifecycle/">コンポーネントのライフサイクル</a></li><li class='toc-level-1 '><a href="../../components/passing-properties-to-a-component/">コンポーネントへのプロパティの受け渡し</a></li><li class='toc-level-1 '><a href="../../components/wrapping-content-in-a-component/">コンポーネント内のコンテンツをラップする</a></li><li class='toc-level-1 '><a href="../../components/customizing-a-components-element/">コンポーネントの要素のカスタマイズ</a></li><li class='toc-level-1 '><a href="../../components/block-params/">ブロック引数を使う</a></li><li class='toc-level-1 '><a href="../../components/handling-events/">イベント処理</a></li><li class='toc-level-1 '><a href="../../components/triggering-changes-with-actions/">アクションによる変更のトリガー</a></li></ol></li><li class='toc-level-0 '><a href="#">コントローラー</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../controllers/">はじめに</a></li></ol></li><li class='toc-level-0 '><a href="#">Models</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../models/">Introduction</a></li><li class='toc-level-1 '><a href="../../models/defining-models/">Defining Models</a></li><li class='toc-level-1 '><a href="../../models/finding-records/">Finding Records</a></li><li class='toc-level-1 '><a href="../../models/creating-updating-and-deleting-records/">Creating, Updating and Deleting</a></li><li class='toc-level-1 '><a href="../../models/relationships/">Relationships</a></li><li class='toc-level-1 '><a href="../../models/pushing-records-into-the-store/">Pushing Records into the Store</a></li><li class='toc-level-1 '><a href="../../models/handling-metadata/">Handling Metadata</a></li><li class='toc-level-1 '><a href="../../models/customizing-adapters/">Customizing Adapters</a></li><li class='toc-level-1 '><a href="../../models/customizing-serializers/">Customizing Serializers</a></li></ol></li><li class='toc-level-0 '><a href="#">Application Concerns</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../applications/applications-and-instances/">Applications and Instances</a></li><li class='toc-level-1 '><a href="../../applications/dependency-injection/">Dependency Injection</a></li><li class='toc-level-1 '><a href="../../applications/initializers/">Initializers</a></li><li class='toc-level-1 '><a href="../../applications/services/">Services</a></li><li class='toc-level-1 '><a href="../../applications/run-loop/">The Run Loop</a></li></ol></li><li class='toc-level-0 '><a href="#">Testing</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../testing/">Introduction</a></li><li class='toc-level-1 '><a href="../../testing/acceptance/">Acceptance Tests</a></li><li class='toc-level-1 '><a href="../../testing/unit-testing-basics/">Unit Testing Basics</a></li><li class='toc-level-1 '><a href="../../testing/testing-components/">Testing Components</a></li><li class='toc-level-1 '><a href="../../testing/testing-helpers/">Testing Helpers</a></li><li class='toc-level-1 '><a href="../../testing/testing-controllers/">Testing Controllers</a></li><li class='toc-level-1 '><a href="../../testing/testing-routes/">Testing Routes</a></li><li class='toc-level-1 '><a href="../../testing/testing-models/">Testing Models</a></li></ol></li><li class='toc-level-0 '><a href="#">Ember Inspector</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../ember-inspector/">Introduction</a></li><li class='toc-level-1 '><a href="../../ember-inspector/installation/">Installing the Inspector</a></li><li class='toc-level-1 '><a href="../../ember-inspector/object-inspector/">Object Inspector</a></li><li class='toc-level-1 '><a href="../../ember-inspector/view-tree/">The View Tree</a></li><li class='toc-level-1 '><a href="../../ember-inspector/routes/">Inspecting Routes</a></li><li class='toc-level-1 '><a href="../../ember-inspector/data/">Data Tab</a></li><li class='toc-level-1 '><a href="../../ember-inspector/deprecations/">Tackling Deprecations</a></li><li class='toc-level-1 '><a href="../../ember-inspector/info/">Library Info</a></li><li class='toc-level-1 '><a href="../../ember-inspector/promises/">Debugging Promises</a></li><li class='toc-level-1 '><a href="../../ember-inspector/container/">Inspecting Objects via the Container</a></li><li class='toc-level-1 '><a href="../../ember-inspector/render-performance/">Rendering Performance</a></li><li class='toc-level-1 '><a href="../../ember-inspector/troubleshooting/">Troubleshooting</a></li></ol></li><li class='toc-level-0 '><a href="#">Addons and Dependencies</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../addons-and-dependencies/managing-dependencies/">Managing Dependencies</a></li></ol></li><li class='toc-level-0 '><a href="#">Configuring Ember.js</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../configuring-ember/configuring-your-app/">Configuring Your App</a></li><li class='toc-level-1 '><a href="../../configuring-ember/configuring-ember-cli/">Configuring Ember CLI</a></li><li class='toc-level-1 '><a href="../../configuring-ember/handling-deprecations/">Handling Deprecations</a></li><li class='toc-level-1 '><a href="../../configuring-ember/disabling-prototype-extensions/">Disabling Prototype Extensions</a></li><li class='toc-level-1 '><a href="../../configuring-ember/specifying-url-type/">Specifying the URL Type</a></li><li class='toc-level-1 '><a href="../../configuring-ember/embedding-applications/">Embedding Applications</a></li><li class='toc-level-1 '><a href="../../configuring-ember/feature-flags/">Feature Flags</a></li><li class='toc-level-1 '><a href="../../configuring-ember/build-targets/">Build targets</a></li><li class='toc-level-1 '><a href="../../configuring-ember/debugging/">Debugging</a></li></ol></li><li class='toc-level-0 '><a href="#">Contributing to Ember.js</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../contributing/adding-new-features/">Adding New Features</a></li><li class='toc-level-1 '><a href="../../contributing/repositories/">Repositories</a></li></ol></li><li class='toc-level-0 '><a href="#">Glossary</a><ol class='toc-level-1'><li class='toc-level-1 '><a href="../../glossary/web-development/">Web Development</a></li></ol></li></ol></nav>

  <a class="back-to-top" href="#">&#11014; トップに戻る</a>
</aside>


      <article class="chapter">
        <h1>
          ロード中とエラーの表示
          <a href="https://github.com/emberjs/guides/edit/master/source/routing/loading-and-error-substates.md"
             target="_blank" class="edit-page icon-pencil">編集</a>
        </h1>
        <hr>

        <!--
The Ember Router allows you to provide feedback that a route is loading, as well
as when an error occurs in loading a route.
-->

<p>Ember Routerでは、ルートのロード中や、エラーが発生したことを、ユーザに見せることができます。</p>

<!--
The `error` and `loading` substates exist as a part of each route, so they
should not be added to your `router.js` file. To utilize a substate, the route, controller,
and template may be optionally defined as desired.
-->

<p><code>error</code>と<code>loading</code>サブステートは各ルートの一部として存在するため、<code>router.js</code>ファイルに追加するべきではありません。
サブステートを活用するために、ルート、コントローラ、およびテンプレートで、必要に応じて任意に定義することもできます。</p>

<!--
## `loading` substates
-->
<h2 id="toc_<code>loading</code>サブステート" class="anchorable-toc"><code>loading</code>サブステート</h2>
<!--
During the `beforeModel`, `model`, and `afterModel` hooks, data may take some
time to load. Technically, the router pauses the transition until the promises
returned from each hook fulfill.
-->

<p><code>beforeModel</code>、<code>model</code>、および<code>afterModel</code>フックでは、データが読み込まれるまでに時間がかかることがあります。
厳密には、各フックから返されたPromiseが達成されるまで、ルータはトランジションを一時停止します。</p>

<!--
Consider the following:
-->

<p>次のコードを見てください。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/router.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>Router.map(<span class="keyword">function</span>() {
  <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">slow-model</span><span class="delimiter">'</span></span>);
});
</pre></td>
</tr></table>
</div></div><div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/slow-model.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Route from <span class="string"><span class="delimiter">'</span><span class="content">@ember/routing/router</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Route.extend({
  model() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>).findAll(<span class="string"><span class="delimiter">'</span><span class="content">slow-model</span><span class="delimiter">'</span></span>);
  }
});
</pre></td>
</tr></table>
</div></div>
<!--
If you navigate to `slow-model`, in the `model` hook,
the query may take a long time to complete.
During this time, your UI isn't really giving you any feedback as to
what's happening. If you're entering this route after a full page
refresh, your UI will be entirely blank, as you have not actually
finished fully entering any route and haven't yet displayed any
templates. If you're navigating to `slow-model` from another
route, you'll continue to see the templates from the previous route
until the model finish loading, and then, boom, suddenly all the
templates for `slow-model` load.
-->

<p><code>slow-model</code>に移動する時に、<code>model</code>フックでクエリが完了するまでに時間がかかることがあります。
この間、UIは実際に何が起こっているかについてのフィードバックをユーザに与えていません。
ブラウザの更新でこのルートにアクセスすると、ルートの処理が完全に終わるまではテンプレートが表示されていないため、完全に空白になページが表示されます。
<code>slow-model</code>に別のルートから移動すると、移動前のルートが表示され続け、<code>slow-model</code>のモデルのロードが完了した途端にドバッと<code>slow-model</code>のテンプレートが一気に表示されます。</p>

<!--
So, how can we provide some visual feedback during the transition?
-->

<p>このような場合に、処理中であることをユーザに見せることできます。</p>

<!--
Simply define a template called `loading` (and optionally a corresponding route)
that Ember will transition to. The
intermediate transition into the loading substate happens immediately
(synchronously), the URL won't be updated, and, unlike other transitions, the
currently active transition won't be aborted.
-->

<p>遷移先のルートに<code>loading</code>(およびオプションで対応するルート)というテンプレートを定義するだけです。
<code>loading</code>サブステートへの変位は直ちに(同期的に)行われ、URLは更新されず、トランジションとは異なり、中止されません。</p>

<!--
Once the main transition into `slow-model` completes, the `loading`
route will be exited and the transition to `slow-model` will continue.
-->

<p><code>slow-model</code>への主トランジションが完了すると、<code>loading</code>ルートが終了し、<code>slow-model</code>へのトランジションが継続されます。</p>

<!--
For nested routes, like:
-->

<p>以下のようなネストしたルートの場合、</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/router.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>Router.map(<span class="keyword">function</span>() {
  <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
      <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">slow-model</span><span class="delimiter">'</span></span>);
    });
  });
});
</pre></td>
</tr></table>
</div></div>
<!--
When accessing `foo.bar.slow-model` route then Ember will alternate trying to
find a `routeName-loading` or `loading` template in the hierarchy starting with
`foo.bar.slow-model-loading`:
-->

<p><code>foo.bar.slow-model</code>ルートにアクセスすると、Emberは、以下ように、<code>foo.bar.slow-model-loading</code>、<code>routeName-loading</code>、<code>loading</code>という順でテンプレートを探します。</p>

<!--
1. `foo.bar.slow-model-loading`
2. `foo.bar.loading` or `foo.bar-loading`
3. `foo.loading` or `foo-loading`
4. `loading` or `application-loading`
-->

<ol>
<li><code>foo.bar.slow-model-loading</code></li>
<li><code>foo.bar.loading</code>または<code>foo.bar-loading</code></li>
<li><code>foo.loading</code>または<code>foo-loading</code></li>
<li><code>loading</code>または<code>application-loading</code></li>
</ol>

<!--
It's important to note that for `slow-model` itself, Ember will not try to
find a `slow-model.loading` template but for the rest of the hierarchy either
syntax is acceptable. This can be useful for creating a custom loading screen
for a leaf route like `slow-model`.
-->

<p><code>slow-model</code>自体にアクセスする場合、Emberは<code>slow-model</code>の<code>loading</code>テンプレートを見つけようとはしませんが、上の階層では上記のルール通りであることに注意してください。
これは、<code>slow-model</code>のような子ルートを持たないルート(葉ルート)でカスタマイズしたロード画面を表示するのに便利です。</p>

<!--
When accessing `foo.bar` route then Ember will search for:
-->

<p><code>foo.bar</code>にアクセスすると、Emberは以下を検索します。</p>

<!--
1. `foo.bar-loading`
2. `foo.loading` or `foo-loading`
3. `loading` or `application-loading`
-->

<ol>
<li><code>foo.bar-loading</code></li>
<li><code>foo.loading</code>または<code>foo-loading</code></li>
<li><code>loading</code>または<code>application-loading</code></li>
</ol>

<!--
It's important to note that `foo.bar.loading` is not considered now.
-->

<p><code>foo.bar.loading</code>は現在考慮されていないことに注意することが重要です。</p>

<!--
### The `loading` event
-->
<h3 id="toc_<code>loading</code>イベント" class="anchorable-toc"><code>loading</code>イベント</h3>
<!--
If the various `beforeModel`/`model`/`afterModel` hooks
don't immediately resolve, a [`loading`](https://www.emberjs.com/api/ember/2.16/classes/Route/events/loading?anchor=loading) event will be fired on that route.
-->

<p><code>beforeModel</code> / <code>model</code> / <code>afterModel</code>フックがすぐに解決されない場合、そのルートの<a href="https://www.emberjs.com/api/ember/2.16/classes/Route/events/loading?anchor=loading"><code>loading</code></a>アクションが呼ばれます。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/foo-slow-model.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Route from <span class="string"><span class="delimiter">'</span><span class="content">@ember/routing/route</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Route.extend({
  model() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>).findAll(<span class="string"><span class="delimiter">'</span><span class="content">slow-model</span><span class="delimiter">'</span></span>);
  },

  <span class="key">actions</span>: {
    loading(transition, originRoute) {
      let controller = <span class="local-variable">this</span>.controllerFor(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>);
      controller.set(<span class="string"><span class="delimiter">'</span><span class="content">currentlyLoading</span><span class="delimiter">'</span></span>, <span class="predefined-constant">true</span>);

      <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// allows the loading template to be shown</span>
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<!--
If the `loading` handler is not defined at the specific route,
the event will continue to bubble above a transition's parent
route, providing the `application` route the opportunity to manage it.
-->

<p><code>loading</code>ハンドラが該当のルートで定義されていない場合、イベントは親ルートに伝達し続け、<code>application</code>ルートにそれを管理する機会を与えます。</p>

<!--
When using the `loading` handler, we can make use of the transition promise to know when the loading event is over:
-->

<p><code>loading</code>ハンドラを使用する場合、ローディングイベントが終了したことを知るためには、トランジションのpromiseを利用します。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/foo-slow-model.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Route from <span class="string"><span class="delimiter">'</span><span class="content">@ember/routing/route</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Route.extend({
  <span class="error">…</span>

  <span class="key">actions</span>: {
    loading(transition, originRoute) {
      let controller = <span class="local-variable">this</span>.controllerFor(<span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>);
      controller.set(<span class="string"><span class="delimiter">'</span><span class="content">currentlyLoading</span><span class="delimiter">'</span></span>, <span class="predefined-constant">true</span>);
      transition.promise.<span class="keyword">finally</span>(<span class="keyword">function</span>() {
          controller.set(<span class="string"><span class="delimiter">'</span><span class="content">currentlyLoading</span><span class="delimiter">'</span></span>, <span class="predefined-constant">false</span>);
      });
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<!--
In case we want both custom logic and the default behaviour for the loading substate,
we can implement the `loading` action and let it bubble by returning `true`.
-->

<p><code>loading</code>サブステートのカスタムロジックとデフォルトの処理の両方が必要な場合は、<code>loading</code>アクションの実装で<code>true</code>を返すことで伝播できます。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/foo-slow-model.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Ember from <span class="string"><span class="delimiter">'</span><span class="content">ember</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  ...
  actions: {
    loading(transition) {
      let start = <span class="keyword">new</span> Date();
      transition.promise.<span class="keyword">finally</span>(() =&gt; {
        <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">notifier</span><span class="delimiter">'</span></span>).notify(<span class="error">`</span>Took <span class="predefined">$</span>{<span class="keyword">new</span> Date() - start}ms to load<span class="error">`</span>);
      });

      <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<!--
## `error` substates
-->
<h2 id="toc_<code>error</code>サブステート" class="anchorable-toc"><code>error</code>サブステート</h2>
<!--
Ember provides an analogous approach to `loading` substates in
the case of errors encountered during a transition.
-->

<p>Emberは、トランジション中にエラーが発生した場合、<code>loading</code>サブステートと似たの手段を提供します。</p>

<!--
Similar to how the default `loading` event handlers are implemented,
the default `error` handlers will look for an appropriate error substate to
enter, if one can be found.
-->

<p><code>loading</code>イベントハンドラーの実装方法と同様に、<code>error</code>ハンドラーも該当する<code>error</code>サブステートがあるか探します。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/router.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>Router.map(<span class="keyword">function</span>() {
  <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">articles</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.route(<span class="string"><span class="delimiter">'</span><span class="content">overview</span><span class="delimiter">'</span></span>);
  });
});
</pre></td>
</tr></table>
</div></div>
<!--
As with the `loading` substate, on a thrown error or rejected promise returned
from the `articles.overview` route's `model` hook (or `beforeModel` or
`afterModel`) Ember will look for an error template or route in the following
order:
-->

<p><code>loading</code>サブステートと同様に、<code>articles.overview</code>ルートの<code>model</code>フック(<code>beforeModel</code>と<code>afterModel</code>を含む）でエラーが起きたり、Promiseがrejectされた場合、Emberは次の順序でエラーテンプレートかルートを探します：</p>

<!--
1. `articles.overview-error`
2. `articles.error` or `articles-error`
3. `error` or `application-error`
-->

<ol>
<li><code>articles.overview-error</code></li>
<li><code>articles.error</code>または<code>articles-error</code></li>
<li><code>error</code>または<code>application-error</code></li>
</ol>

<!--
If one of the above is found, the router will immediately transition into
that substate (without updating the URL). The "reason" for the error
(i.e. the exception thrown or the promise reject value) will be passed
to that error state as its `model`.
-->

<p>上記のいずれかが見つかった場合、ルータはすぐにそのサブステートに移ります。(URLは更新されません)
エラーの理由(すなわち、throwされた例外またはPromiseのリジェクト値)、errorが以下のように<code>model</code>として渡されます。</p>

<!--
The model hooks (`beforeModel`, `model`, and `afterModel`) of an error substate
are not called. Only the `setupController` method of the error substate is
called with the `error` as the model. See example below:
-->

<p>エラーサブステートのモデルフック群(<code>beforeModel</code>、<code>model</code>、および<code>afterModel</code>)は呼び出されません。
エラーサブステートの<code>setupController</code>メソッドのみがモデルとして<code>error</code>とともに呼び出されます。
以下の例を参照してください。</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>setupController(controller, error) {
  Ember.Logger.debug(error.message);
  <span class="local-variable">this</span>._super(...<span class="local-variable">arguments</span>);
}
</pre></td>
</tr></table>
</div></div>
<!--
If no viable error substates can be found, an error message will be
logged.
-->

<p>実行可能なエラーサブステートが見つからない場合は、エラーメッセージがログに記録されます。</p>

<!--
### The `error` event
-->
<h3 id="toc_<code>error</code>イベント" class="anchorable-toc"><code>error</code>イベント</h3>
<!--
If the `articles.overview` route's `model` hook returns a promise that rejects
(for instance the server returned an error, the user isn't logged in,
etc.), an [`error`](https://www.emberjs.com/api/ember/2.16/classes/Route/events/error?anchor=error) event will fire from that route and bubble upward.
This `error` event can be handled and used to display an error message,
redirect to a login page, etc.
-->

<p><code>articles.overview</code>ルートの<code>model</code>フックでPromiseがrejctされた場合(例えばサーバからエラーが返されたり、ユーザがログインしていないなど)、<a href="https://www.emberjs.com/api/ember/2.16/classes/Route/events/error?anchor=error"><code>error</code></a>イベントはそのルートから発生して、親ルートに伝播されます。
<code>error</code>イベントは、エラーメッセージの表示、ログインページへのリダイレクトなどに使用できます。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/articles-overview.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Route from <span class="string"><span class="delimiter">'</span><span class="content">@ember/routing/route</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Route.extend({
  model(params) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>).findAll(<span class="string"><span class="delimiter">'</span><span class="content">privileged-model</span><span class="delimiter">'</span></span>);
  },

  <span class="key">actions</span>: {
    error(error, transition) {
      <span class="keyword">if</span> (error.status === <span class="string"><span class="delimiter">'</span><span class="content">403</span><span class="delimiter">'</span></span>) {
        <span class="local-variable">this</span>.replaceWith(<span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>);
      } <span class="keyword">else</span> {
        <span class="comment">// Let the route above this handle the error.</span>
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
      }
    }
  }
});
</pre></td>
</tr></table>
</div></div>
<!--
Analogous to the `loading` event, you could manage the `error` event
at the application level to avoid writing the same code for multiple routes.
-->

<p><code>loading</code>イベントと同様に、アプリケーションレベルで<code>error</code>イベントを管理して、複数のルートで同じコードを書かないようにすることができます。</p>

<!--
In case we want to run some custom logic and have the default behaviour of rendering the error template,
we can handle the `error` event and let it bubble by returning `true`.
-->

<p>任意の処理の後に、errorテンプレートを描画するデフォルトの処理が必要な場合は、<code>error</code>イベントを実装し、<code>true</code>を返して伝達させます。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay">
  <thead>
    <tr>
      <td colspan="2">app/routes/articles-overview.js</td>
    </tr>
  </thead>
<tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> Ember from <span class="string"><span class="delimiter">'</span><span class="content">ember</span><span class="delimiter">'</span></span>;

<span class="reserved">export</span> <span class="keyword">default</span> Ember.Route.extend({
  model(params) {
    <span class="keyword">return</span> <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">store</span><span class="delimiter">'</span></span>).findAll(<span class="string"><span class="delimiter">'</span><span class="content">privileged-model</span><span class="delimiter">'</span></span>);
  },
  <span class="key">actions</span>: {
    error(error) {
      <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">notifier</span><span class="delimiter">'</span></span>).error(error);

      <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
  }
});
</pre></td>
</tr></table>
</div></div>


        
      <footer>
        <a class="previous-guide" href="../preventing-and-retrying-transitions/">トランジションの中止と再開</a> <a class="next-guide" href="../query-params/">クエリーパラメーター</a>
      </footer>
      
      </article>
    </main>

    <div class="footer">
  <div class="container">
    <div class="footer-info">
      Copyright 2018
      <a href="http://tilde.io">Tilde Inc.</a>
      <br>
      <a href="http://emberjs.com/team">コアチーム</a> |
      <a href="http://emberjs.com/sponsors">スポンサー</a>
      <br>
      <a href="http://emberjs.com/security">セキュリティ</a> |
      <a href="http://emberjs.com/legal">法関連</a> |
      <a href="http://emberjs.com/logos">ロゴ</a>
      <br>
      <a href="http://emberjs.com/guidelines">コミュニティガイドライン</a>
    </div>

    <div class="footer-statement">
      Ember.js is free, open source and always will be.
    </div>

    <div class="footer-social">
      <a href="http://twitter.com/emberjs"
        title="Twitter">
        <i class="icon-twitter"></i>
      </a>
      <a href="https://github.com/emberjs/ember.js"
        title="GitHub">
        <i class="icon-github"></i>
      </a>
      <a href="https://plus.google.com/communities/106387049790387471205"
        title="Google+">
        <i class="icon-gplus"></i>
      </a>
    </div>
  </div>
</div>


    

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-27675533-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
